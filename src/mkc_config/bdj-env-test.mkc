
loadunit env-main
loadunit env-systype
loadunit env-cc
loadunit env-msgfmt
loadunit env-extension

output  bdj-env.test

standard_system
standard_cc

if iswindows ! ( ( == _MKCONFIG_SYSTYPE Linux ) || ( == _MKCONFIG_SYSTYPE Darwin ) )
 option NO_PIE T
 addincpath ../plocal/include
 addldsrchpath ../plocal/lib
 addldflag -static-libgcc
endif

# standard flags
addcflag -Wextra
addcflag -Wno-unused-but-set-variable
addcflag -Wno-unused-parameter
addcflag -Wno-unknown-pragmas
addcflag -Wno-float-equal
addcflag -Wno-stringop-overflow
addcflag -Wno-stringop-truncation

# for pthreads
addcflag -pthread
addldflag -pthread

# darwin/vlc
addincpath /Applications/VLC.app/Contents/MacOS/include
addldsrchpath /Applications/VLC.app/Contents/MacOS/lib

# darwin/macports
addincpath /opt/local/include
addldsrchpath /opt/local/lib

# windows/vlc
addincpath vlc-3.0.16
addldsrchpath '/c/Program Files/VideoLAN/VLC'
addldsrchpath '/c/Program Files (x86)/VideoLAN/VLC'

# darwin/volume
addldflag -framework Cocoa
addldflag -framework CoreAudio

# turn off gcc warning
addcflag -Wno-format-truncation

# Warn about declarations after statement.
# I don't think the style of mixing declarations in with
# the code is going to be maintainable.
addcflag -Wdeclaration-after-statement
addcflag -Wmissing-prototypes

# gcc hardening
# reference: wiki.debian.org/Hardening
addcflag -Wformat
addcflag -Wformat-security
addcflag -Werror=format-security

# these confuse other compilers...make them GCC only
# solaris will not link w/-fstack-protector, so it
# can only be set when the gnu linker is in use.
if UsingGNU_LD ( == _MKCONFIG_USING_GNU_LD Y ) && ( == _MKCONFIG_USING_GCC Y )
 ifnotoption NO_PIE
  addcflag -fstack-protector-strong
  addcflag -fstack-protector-all
  addldflag -fstack-protector-strong
  addldflag -fstack-protector-all
  addcflag -D_FORTIFY_SOURCE=2
 else
  addcflag -D_FORTIFY_SOURCE=0
 endif
endif

# these confuse other compilers...make them CLANG only
if UsingCLANG == _MKCONFIG_USING_CLANG Y
 # turn off mac os warning
 addcflag -Wno-poison-system-directories
 addcflag -Wno-shift-sign-overflow
 addcflag -Wno-reserved-macro-identifier
 addcflag -Wno-reserved-id-macro
 addcflag -Wno-implicit-int-conversion
 addcflag -Wno-switch-enum
 addcflag -Wno-gnu-zero-variadic-macro-arguments
 addcflag -Wno-documentation-deprecated-sync
 addcflag -Wno-documentation-unknown-command
 addcflag -Wno-documentation

 ifnotoption NO_PIE
  addcflag -fstack-protector-strong
  addcflag -fstack-protector-all
  addldflag -fstack-protector-strong
  addldflag -fstack-protector-all
  addcflag -D_FORTIFY_SOURCE=2
 else
  addcflag -D_FORTIFY_SOURCE=0
 endif
endif

libs
shared_flags

addldflag -Wl,--as-needed

extension obj
extension exe
extension shlib

pkg    include check
pkg    libs check

cmd_msgfmt
